files1 <- c(
  "/Users/oliviaxu/Desktop/wavelet_project/without_dwt/without_dwt_matrices/without_dwt_1_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/without_dwt/without_dwt_matrices/without_dwt_2_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/without_dwt/without_dwt_matrices/without_dwt_3_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/without_dwt/without_dwt_matrices/without_dwt_4_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/without_dwt/without_dwt_matrices/without_dwt_5_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/without_dwt/without_dwt_matrices/without_dwt_6_5.csv"
)

files2 <- c(
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view0_matrices/3band_2reg_view0_1_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view0_matrices/3band_2reg_view0_2_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view0_matrices/3band_2reg_view0_3_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view0_matrices/3band_2reg_view0_4_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view0_matrices/3band_2reg_view0_5_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view0_matrices/3band_2reg_view0_6_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view0_matrices/3band_2reg_view0_7_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view1_matrices/3band_2reg_view1_1_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view1_matrices/3band_2reg_view1_2_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view1_matrices/3band_2reg_view1_3_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view1_matrices/3band_2reg_view1_4_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view1_matrices/3band_2reg_view1_5_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view2_matrices/3band_2reg_view2_1_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view2_matrices/3band_2reg_view2_2_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view2_matrices/3band_2reg_view2_3_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view2_matrices/3band_2reg_view2_4_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/3band_2reg/wavelet_3band_2reg_view2_matrices/3band_2reg_view2_5_5.csv"
)

files3 <- c(
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view0_matrices/4band_2reg_view0_1_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view0_matrices/4band_2reg_view0_2_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view0_matrices/4band_2reg_view0_3_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view0_matrices/4band_2reg_view0_4_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view0_matrices/4band_2reg_view0_5_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view0_matrices/4band_2reg_view0_6_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view0_matrices/4band_2reg_view0_7_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view1_matrices/4band_2reg_view1_1_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view1_matrices/4band_2reg_view1_2_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view1_matrices/4band_2reg_view1_3_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view1_matrices/4band_2reg_view1_4_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view2_matrices/4band_2reg_view2_1_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view2_matrices/4band_2reg_view2_2_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view2_matrices/4band_2reg_view2_3_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view2_matrices/4band_2reg_view2_4_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view2_matrices/4band_2reg_view2_5_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view2_matrices/4band_2reg_view2_6_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view3_matrices/4band_2reg_view3_1_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view3_matrices/4band_2reg_view3_2_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view3_matrices/4band_2reg_view3_3_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view3_matrices/4band_2reg_view3_4_5.csv",
  "/Users/oliviaxu/Desktop/wavelet_project/4band_2reg/wavelet_4band_2reg_view3_matrices/4band_2reg_view3_5_5.csv"
)

TFH     <- "Celltype_TFH CD4 T Cell"
ACINAR  <- "Celltype_Pancreas Acinar Cell"

read_and_filter <- function(path, keep_celltype) {
  df <- suppressWarnings(read_csv(path, show_col_types = FALSE))
  req <- c("Source", "Target", "Signed_weight")
  if (!all(req %in% names(df))) {
    warning(sprintf("Skipping %s (missing required columns)", path))
    return(NULL)
  }
  df %>%
    transmute(
      Source = trimws(as.character(.data$Source)),
      Target = trimws(as.character(.data$Target)),
      Signed_weight = suppressWarnings(as.numeric(.data$Signed_weight))
    ) %>%
    filter(Source == keep_celltype | Target == keep_celltype)
}

process_group <- function(files_vec, keep_celltype, out_path) {
  res <- files_vec %>%
    map(read_and_filter, keep_celltype = keep_celltype) %>%
    bind_rows()
  
  if (is.null(res) || nrow(res) == 0) {
    res <- tibble(
      Source = character(),
      Target = character(),
      Signed_weight = numeric()
    )
  } else {
    res <- res %>%
      distinct(Source, Target, Signed_weight) %>%
      arrange(desc(abs(Signed_weight)), Source, Target)
  }
  
  write_csv(res, out_path)
  message(sprintf("Wrote %d rows to %s", nrow(res), out_path))
}


out_dir <- "/Users/oliviaxu/Desktop/wavelet_project/cell_cell"

process_group(files1, TFH,    file.path(out_dir, "cell_cell_filtered_without_dwt_TFH.csv"))
process_group(files1, ACINAR, file.path(out_dir, "cell_cell_filtered_without_dwt_Acinar.csv"))

process_group(files2, TFH,    file.path(out_dir, "cell_cell_filtered_3band_TFH.csv"))
process_group(files2, ACINAR, file.path(out_dir, "cell_cell_filtered_3band_Acinar.csv"))

process_group(files3, TFH,    file.path(out_dir, "cell_cell_filtered_4band_TFH.csv"))
process_group(files3, ACINAR, file.path(out_dir, "cell_cell_filtered_4band_Acinar.csv"))

files34 <- c(files2, files3)

process_group(files34, TFH,    file.path(out_dir, "cell_cell_filtered_3and4band_TFH.csv"))
process_group(files34, ACINAR, file.path(out_dir, "cell_cell_filtered_3and4band_Acinar.csv"))





genes_in <- c("IGFL2","CCL18","CRISP3","MUC5B","ALDOB","SCGB3A1","CRISP2",
              "MOGAT1","ACE2","TCN1","DMBT1","ALDH1A2","JCHAIN","TFF2",
              "MUC5AC","MUC17","MUCL3","ANXA10","VSIG1","TFF1","TFF3",
              "INS","IAPP","G6PC2","CHGA","SST","TTR","GCG",
              "SLURP2","PTGS2","KRT16","ANGPTL4","CP","LY6D","CELA2A",
              "AMY2A","PNLIP","CELA2B","CPA1","SYCN","CLPS","PRSS1",
              "KLRC4","GZMK","KLRG1","KLRK1","PYHIN1","THEMIS","ANGPTL7",
              "FABP4","PLA2G2A","CXCL11","DES","CDH19","NPSR1","KLK7",
              "CLDN18","SLC26A9","COL17A1","CXCL5","CCL24")

out_dir <- "/Users/oliviaxu/Desktop/wavelet_project/gene_gene"

read_and_filter_gene <- function(path, keep_gene) {
  df <- suppressWarnings(read_csv(path, show_col_types = FALSE))
  req <- c("Source","Target","Signed_weight")
  if (!all(req %in% names(df))) return(NULL)
  df %>%
    transmute(
      Source = trimws(as.character(.data$Source)),
      Target = trimws(as.character(.data$Target)),
      Signed_weight = suppressWarnings(as.numeric(.data$Signed_weight))
    ) %>%
    filter(Source == keep_gene | Target == keep_gene)
}

process_group_gene <- function(files_vec, keep_gene, out_path) {
  res <- files_vec %>%
    map(read_and_filter_gene, keep_gene = keep_gene) %>%
    bind_rows()
  if (is.null(res) || nrow(res) == 0) {
    res <- tibble(Source=character(), Target=character(), Signed_weight=numeric())
  } else {
    res <- res %>% distinct(Source,Target,Signed_weight) %>%
      arrange(desc(abs(Signed_weight)), Source, Target)
  }
  write_csv(res, out_path)
  message(sprintf("[%s] wrote %d rows -> %s", keep_gene, nrow(res), out_path))
}

for (g in genes_in) {
  process_group_gene(files1, g, file.path(out_dir, paste0("gene_gene_filtered_without_dwt_", g, ".csv")))
  process_group_gene(files2, g, file.path(out_dir, paste0("gene_gene_filtered_3band_", g, ".csv")))
  process_group_gene(files3, g, file.path(out_dir, paste0("gene_gene_filtered_4band_", g, ".csv")))
  process_group_gene(c(files2,files3), g, file.path(out_dir, paste0("gene_gene_filtered_3and4band_", g, ".csv")))
}



out_dir <- "/Users/oliviaxu/Desktop/wavelet_project/gene_cell"


read_and_filter_gene_cell <- function(path, genes, keep_celltype) {
  df <- suppressWarnings(read_csv(path, show_col_types = FALSE))
  req <- c("Source", "Target", "Signed_weight")
  if (!all(req %in% names(df))) return(NULL)
  
  df %>%
    transmute(
      Source = trimws(as.character(Source)),
      Target = trimws(as.character(Target)),
      Signed_weight = suppressWarnings(as.numeric(Signed_weight))
    ) %>%
    filter(Source %in% genes, Target == keep_celltype) %>%
    distinct(Source, Target, Signed_weight) %>%
    arrange(desc(abs(Signed_weight)), Source, Target)
}

process_group_gene_cell <- function(files_vec, genes, celltype, out_path) {
  res <- files_vec %>%
    map(read_and_filter_gene_cell, genes = genes, keep_celltype = celltype) %>%
    bind_rows()
  
  if (is.null(res) || nrow(res) == 0) {
    res <- tibble(Source = character(), Target = character(), Signed_weight = numeric())
  }
  write_csv(res, out_path)
  message(sprintf("[%s] wrote %d rows -> %s", celltype, nrow(res), out_path))
}

process_group_gene_cell(files1, genes_in, TFH,    file.path(out_dir, "gene_cell_without_dwt_TFH.csv"))
process_group_gene_cell(files1, genes_in, ACINAR, file.path(out_dir, "gene_cell_without_dwt_Acinar.csv"))

process_group_gene_cell(files2, genes_in, TFH,    file.path(out_dir, "gene_cell_3band_TFH.csv"))
process_group_gene_cell(files2, genes_in, ACINAR, file.path(out_dir, "gene_cell_3band_Acinar.csv"))

process_group_gene_cell(files3, genes_in, TFH,    file.path(out_dir, "gene_cell_4band_TFH.csv"))
process_group_gene_cell(files3, genes_in, ACINAR, file.path(out_dir, "gene_cell_4band_Acinar.csv"))

files34 <- c(files2, files3)
process_group_gene_cell(files34, genes_in, TFH,    file.path(out_dir, "gene_cell_3and4band_TFH.csv"))
process_group_gene_cell(files34, genes_in, ACINAR, file.path(out_dir, "gene_cell_3and4band_Acinar.csv"))

